services:
  mosquitto:
    image: eclipse-mosquitto:2
    container_name: mosquitto-test
    ports:
      - "1883:1883"
    command: >
      sh -c "echo 'listener 1883' > /mosquitto/config/mosquitto.conf &&
             echo 'allow_anonymous true' >> /mosquitto/config/mosquitto.conf &&
             /usr/sbin/mosquitto -c /mosquitto/config/mosquitto.conf"

  wiremock:
    image: wiremock/wiremock:latest
    container_name: wiremock-test
    ports:
      - "8080:8080"
    volumes:
      - ./wiremock/mappings:/home/wiremock/mappings
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8080/__admin" ]
      interval: 5s
      timeout: 2s
      retries: 5
      start_period: 2s
